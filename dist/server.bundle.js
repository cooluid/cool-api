!function(e){var t={};function r(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(o,n,function(t){return e[t]}.bind(null,n));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=17)}([function(e,t){e.exports=require("koa-router")},function(e,t){e.exports=require("redis")},function(e,t){e.exports=require("koa")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("koa-helmet")},function(e,t){e.exports=require("koa-static")},function(e,t){e.exports=require("koa-combine-routers")},function(e,t){e.exports=require("svg-captcha")},function(e,t){e.exports=require("bluebird")},function(e,t){e.exports=require("nodemailer")},function(e,t){e.exports=require("moment")},function(e,t){e.exports=require("koa-body")},function(e,t){e.exports=require("koa-json")},function(e,t){e.exports=require("@koa/cors")},function(e,t){e.exports=require("koa-compose")},function(e,t){e.exports=require("koa-compress")},function(e,t,r){"use strict";var o=r(6),n=r.n(o),i=r(0),a=r.n(i),s=r(7),c=r.n(s),u=r(1),d=r.n(u),p=r(8);const l={host:"111.230.172.136",port:15001,password:"123456",detect_buffers:!0,retry_strategy:function(e){return e.error&&"ECONNREFUSED"===e.error.code?new Error("The server refused the connection"):e.total_retry_time>36e5?new Error("Retry time exhausted"):e.attempt>10?void 0:Math.min(100*e.attempt,3e3)}},f=Object(p.promisifyAll)(d.a.createClient(l));f.on("error",e=>{console.log("Redis Client Error:"+e)});const m=(e,t)=>{void 0!==t&&""!=t&&null!=t&&("string"==typeof t?f.set(e,vale):"object"==typeof t&&Object.keys(t).forEach(r=>{f.hset(e,r,t[r],d.a.print)}))};var g=new class{constructor(){}async getCaptcha(e){let t=e.request.query;console.log(t.sid);let r=c.a.create({size:4,color:!0,ignoreChars:"1il0oz2",width:150,height:38,noise:Math.floor(5*Math.random())});m(t.sid,r.text),e.body={code:200,data:r.data}}};const x=new a.a;x.get("/getCaptcha",g.getCaptcha);var b=x,y=r(9),h=r.n(y);var v=async function(e){let t=h.a.createTransport({host:"smtp.qq.com",port:587,secure:!1,auth:{user:"350670694@qq.com",pass:"xakxdnzqsdjgcafh"}});return`Message sent: %s ${(await t.sendMail({from:`${e.from}`,to:`${e.to}`,subject:"最酷社区激活验证码",text:`最酷社区激活验证码:${e.user}`,html:`  <body>\n    <div style="border: 1px solid #dcdcdc;color: #676767;width: 600px; margin: 0 auto; padding-bottom: 50px;position: relative;">\n        <div style="height: 60px; background: #393d49; line-height: 60px; color: #58a36f; font-size: 18px;padding-left: 10px;">Imooc社区——欢迎来到官方社区</div>\n        <div style="padding: 25px">\n          <div>您好，${e.user}童鞋，重置链接有效时间30分钟，请在${e.expire}之前重置您的密码：</div>\n          <a href="http://5200.me" style="padding: 10px 20px; color: #fff; background: #009e94; display: inline-block;margin: 15px 0;">立即重置密码</a>\n          <div style="padding: 5px; background: #f2f2f2;">如果该邮件不是由你本人操作，请勿进行激活！否则你的邮箱将会被他人绑定。</div>\n        </div>\n        <div style="background: #fafafa; color: #b4b4b4;text-align: center; line-height: 45px; height: 45px; position: absolute; left: 0; bottom: 0;width: 100%;">系统邮件，请勿直接回复</div>\n    </div>\n  </body>`})).messageId}`},q=r(10),k=r.n(q);var j=new class{constructor(){}async testApi(e){console.log(e.request),e.body={code:200}}async forget(e){const{body:t}=e.request;try{let r=await v({code:"1234",from:"社区激活验证码 350670694@qq.com",to:"350670694@qq.com",expire:k()().add(30,"m").format("YYYY-MM-DD HH:mm:ss"),email:t.username,user:"cool"});e.body={code:200,data:r,msg:"邮件发送成功"}}catch(e){console.log(`错误的数据：${e}`)}}};const w=new a.a;w.post("/forget",j.forget),w.get("/testapi",j.testApi);var M=w;t.a=n()(b,M)},function(e,t,r){"use strict";r.r(t),function(e){var t=r(2),o=r.n(t),n=r(3),i=r.n(n),a=r(4),s=r.n(a),c=r(5),u=r.n(c),d=r(16),p=r(11),l=r.n(p),f=r(12),m=r.n(f),g=r(13),x=r.n(g),b=r(14),y=r.n(b),h=r(15),v=r.n(h);const q=new o.a,k=y()([l()(),u()(i.a.join(e,"../public")),x()(),m()({pretty:!1,param:"pretty"}),s()()]);q.use(v()()),q.use(k),q.use(Object(d.a)()),q.listen(3e3)}.call(this,"src")}]);